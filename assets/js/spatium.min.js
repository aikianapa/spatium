"use strict";if(wbapp.loadStyles(["https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;500;600;700&subset=latin,cyrillic"]),setTimeout((function(){$(".parallax").each((function(){let img=$(this).attr("data-img");void 0!==img&&$(this).css("background-image","url("+img+")").removeAttr("data-img")})),$(".img-caption").on("mouseover mouseout",(function(){$(this).find("figcaption").toggleClass("op-0")})),$("#faq-accordion").accordion({heightStyle:"content",collapsible:!0,active:!1}),$("loader").hide()}),1),!wbapp._session.user||!wbapp._session.user.id||wbapp._session.user.id<" ")var uid="unknown";else var uid=wbapp._session.user.id;$(".scroll-top").on("click",(function(){$("html,body").animate({scrollTop:0},2e3)})),$.fn.lightGallery=function(options){this.length&&$(this).each((function(){let lg=lightGallery(this,options)}))},wbapp.on("ready",(function(){$("#programs").lightGallery({selector:"[data-iframe]",download:!1,counter:!1}),$(".gallery").lightGallery({selector:"div[data-src]",download:!1,counter:!1,zoom:!0}),$(document).delegate(".lg-outer","mousewheel",(function(e){e.originalEvent.wheelDelta/120>0?$(this).find(".lg-prev").trigger("click"):$(this).find(".lg-next").trigger("click"),e.stopPropagation()})),$("#shopping-cart .accordion").accordion({heightStyle:"content"})}));var getCartData=function(){let form=$("form#Details").serializeJson(),data=wbapp.storage("mod.cart."+uid);if(null!=form&&null!=data)return data.user=form,JSON.stringify(data)};$(document).delegate(".checkout-btn",wbapp.evClick,(function(e){e.stopPropagation(),wbapp.loadScripts(["https://widget.cloudpayments.ru/bundles/cloudpayments"],"cloudpayment",(function(){var widget=new cp.CloudPayments,iid=Object.keys(wbapp.storage("mod.cart"))[0],sum=1*wbapp.storage("mod.cart."+uid+".total.sum"),data=getCartData(),token=md5(data+uid+time()),options={publicId:"test_api_00000000000000000000001",description:"Оплата товаров в Spatium Detox",amount:sum,currency:"RUB",accountId:uid,invoiceId:uid,skin:"modern",data:{token:token}};widget.pay("auth",options,{onSuccess:function(options){options.data.token==token&&1==paymentResult.success&&(setcookie("carttoken",token,time()+1e3),$.redirectPost("/orders/checkout",{data:data,token:token}))},onFail:function(reason,options){},onComplete:function(paymentResult,options){options.data.token==token&&1==paymentResult.success&&(setcookie("carttoken",token,time()+1e3),$.redirectPost("/orders/checkout",{data:data,token:token}))}})}))})),$(document).delegate("#deliveryCalendar .day",wbapp.evClick,(function(ev){let date=$(this).data("date"),data=wbapp.template["#deliveryCalendar"].params.data[date].products;var tid="#modalProdList";Ractive({target:tid,template:wbapp.template[tid].html,data:{result:data}}),wbapp.lazyload(),$("#modalRight").modal("show"),ev.stopPropagation()})),$(document).delegate("#deliveryCalendar .day .fa-close",wbapp.evClick,(function(ev){var type=null,$that=$(this).parents(".day");if(!$that.hasClass("wait")&&!$that.hasClass("past")){if($that.hasClass("empty")&&(type="empty"),$that.hasClass("deny")&&(type="deny"),type){$that.addClass("wait");var date=$that.data("date"),tid="#deliveryCalendar";wbapp.post("/cms/ajax/form/users/delivery_decline",{type:type,date:date},(function(data){$that.removeClass("wait"),wbapp.render(tid,{result:data})}))}ev.stopPropagation()}})),wbapp.on("mod-cart-add",(function(){setTimeout(()=>{$("#cart").addClass("show")})})),$(document).delegate("#Details [name=date][type=hidden]","change",(function(e){if(e.stopPropagation(),null==wbapp._session.user.id)return;let data=wbapp.postSync("/orders/get_date_dlvrs",{date:$(this).val()});null!=data&&null!=data.result&&(data.result.length?(wbapp.storage("tmp.crossdelivery",data.result),$("#Details .cross-delivery p > span").html(data.freedate),$("#Details .cross-delivery").removeClass("d-none"),$("#Details .cross-delivery p > span").off(wbapp.evClick),$("#Details .cross-delivery p > span").on(wbapp.evClick,(function(){$("#Details [name=date]:not([type=hidden])").val(data.freedate),$("#Details [name=date][type=hidden]").trigger("change")}))):$("#Details .cross-delivery").addClass("d-none"))})),$("#Details [name=date][type=hidden]").trigger("change"),$.extend({redirectPost:function(location,args){var form="";$.each(args,(function(key,value){value=value.split('"').join('"'),form+='<textarea style="display:none;" name="'+key+'">'+value+"</textarea>"})),$('<form action="'+location+'" method="POST">'+form+"</form>").appendTo($(document.body)).submit()}});